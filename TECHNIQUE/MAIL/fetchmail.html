
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://www.uepal.fr/TECHNIQUE/MAIL/fetchmail.html">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Réception - Documentation UEPAL Civiparoisse</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reception-de-mails" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Documentation UEPAL Civiparoisse" class="md-header__button md-logo" aria-label="Documentation UEPAL Civiparoisse" data-md-component="logo">
      
  <img src="../../assets/uepal-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation UEPAL Civiparoisse
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Réception
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Documentation UEPAL Civiparoisse" class="md-nav__button md-logo" aria-label="Documentation UEPAL Civiparoisse" data-md-component="logo">
      
  <img src="../../assets/uepal-logo.svg" alt="logo">

    </a>
    Documentation UEPAL Civiparoisse
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Présentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Présentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Présentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../PRESENTATION/index.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../PRESENTATION/presentation_fonctionnelle.html" class="md-nav__link">
        Périmètre fonctionnel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../PRESENTATION/presentation_ecosysteme.html" class="md-nav__link">
        Ecosystème projet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../PRESENTATION/presentation_livrables.html" class="md-nav__link">
        Livrables
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Technique
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Technique" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Technique
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../roles.html" class="md-nav__link">
        Rôles
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Mail
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mail" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Mail
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="mail.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ecosysteme.html" class="md-nav__link">
        Ecosystème
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sendmail.html" class="md-nav__link">
        Envoi
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Réception
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="fetchmail.html" class="md-nav__link md-nav__link--active">
        Réception
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#client-mail" class="md-nav__link">
    Client mail
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serveur-mda-imap" class="md-nav__link">
    Serveur MDA (IMAP)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maildirfetcher" class="md-nav__link">
    Maildirfetcher
  </a>
  
    <nav class="md-nav" aria-label="Maildirfetcher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialisation-du-dossier-de-maildir-et-dossiers-dependants" class="md-nav__link">
    Initialisation du dossier de Maildir et dossiers dépendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetchmail" class="md-nav__link">
    Fetchmail
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#putmail" class="md-nav__link">
    Putmail
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Logiciel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Logiciel" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Logiciel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LOGICIEL/index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LOGICIEL/distribution_code_composer.html" class="md-nav__link">
        Distribution de code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LOGICIEL/environnement_dev.html" class="md-nav__link">
        Environnement de dev
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LOGICIEL/environnement_dev_env.html" class="md-nav__link">
        Personnalisation environnement de dev
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LOGICIEL/importation.html" class="md-nav__link">
        Importation de données
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Intégration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Intégration" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Intégration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/index.html" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/etude_authentification.html" class="md-nav__link">
        Authentification
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4_3" type="checkbox" id="__nav_3_4_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4_3">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_4_3">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/docker.html" class="md-nav__link">
        Description générale
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4_3_2" type="checkbox" id="__nav_3_4_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4_3_2">
          Images
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Images" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_4_3_2">
          <span class="md-nav__icon md-icon"></span>
          Images
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/composer_base.html" class="md-nav__link">
        Composer_base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/composer_files.html" class="md-nav__link">
        Composer_files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/tools.html" class="md-nav__link">
        tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/init.html" class="md-nav__link">
        init
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/cron.html" class="md-nav__link">
        cron
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/selfkeys.html" class="md-nav__link">
        selfkeys
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/httpd.html" class="md-nav__link">
        httpd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/authenticator.html" class="md-nav__link">
        authenticator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/proxy.html" class="md-nav__link">
        proxy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/db_tls_server.html" class="md-nav__link">
        db_tls_server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/db_tls_client.html" class="md-nav__link">
        db_tls_client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/DOCKER/update.html" class="md-nav__link">
        update
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/db_ssl.html" class="md-nav__link">
        DB_SSL
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4_5" type="checkbox" id="__nav_3_4_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4_5">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_4_5">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/maquettage.html" class="md-nav__link">
        Maquettage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/ressources.html" class="md-nav__link">
        Ressources utiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4_5_3" type="checkbox" id="__nav_3_4_5_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4_5_3">
          Chart Helm
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chart Helm" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_4_5_3">
          <span class="md-nav__icon md-icon"></span>
          Chart Helm
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/HELM/description_generale.html" class="md-nav__link">
        Description générale
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/HELM/db_dbproxy.html" class="md-nav__link">
        DB et DB proxy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/HELM/httpd.html" class="md-nav__link">
        Serveur web interne
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/HELM/proxy_auth.html" class="md-nav__link">
        Proxy et authenticateur
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/HELM/cron.html" class="md-nav__link">
        Cron
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/HELM/volumes.html" class="md-nav__link">
        Volumes (persistants)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/HELM/secrets.html" class="md-nav__link">
        Secrets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../INTEGRATION/KUBERNETES/HELM/reservations.html" class="md-nav__link">
        Réservations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#client-mail" class="md-nav__link">
    Client mail
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serveur-mda-imap" class="md-nav__link">
    Serveur MDA (IMAP)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maildirfetcher" class="md-nav__link">
    Maildirfetcher
  </a>
  
    <nav class="md-nav" aria-label="Maildirfetcher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialisation-du-dossier-de-maildir-et-dossiers-dependants" class="md-nav__link">
    Initialisation du dossier de Maildir et dossiers dépendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetchmail" class="md-nav__link">
    Fetchmail
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#putmail" class="md-nav__link">
    Putmail
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="reception-de-mails">Réception de mails</h1>
<!-- Est ce que les abbréviations sont définies quelque part ? Si oui, est-ce qu'on peut mettre un lien ? -->

<p>La réception des mails suppose d'abord l'envoi d'un mail à recevoir. Les mails transitent généralement par un ou plusieurs MTA avant d'arriver à un MDA, mais avec <code>msmtp</code> il est également possible d'utiliser le protocole LMTP pour transmettre à un MDA le mail directement.</p>
<p>Dans le cadre de l'expérimentation, trois éléments ont été mis en oeuvre :</p>
<ul>
<li>un client mail, qui va transmettre le mail au MDA</li>
<li>un serveur MDA</li>
<li>un programme de récupération des mails</li>
</ul>
<h2 id="client-mail">Client mail</h2>
<p>Un mail de test a été forgé manuellement :
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>From: src@src.test
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>To: dst@dst.test
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Subject: test
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Message
</code></pre></div></p>
<p>Comme expliqué en introduction, msmtp peut utiliser le protocole LMTP. Cette possibilité a été exploitée via une configuration adéquate :
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>defaults
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>account default
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>host dovecot
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>port 24
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>user src@src.test
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>password pass
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>protocol lmtp
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>logfile -
</code></pre></div></p>
<p>Et l'envoi est prévu par une commande :
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>cat /mail/test1.txt<span class="p">|</span> msmtp -t -i -C <span class="si">${</span><span class="nv">MSMTPCONFIGFILE</span><span class="si">}</span> --read-envelope-from
</code></pre></div></p>
<h2 id="serveur-mda-imap">Serveur MDA (IMAP)</h2>
<p>Plusieurs serveurs ont été testés en vue d'une expérimentation en approche "quick and dirty". Cette approche a été préférée pour le moment car il n'est pas sûr que le fonctionnement séparé de CiviCRM sera réellement intégré, et d'autre part, le serveur IMAP est typiquement un élément fourni par un provider tiers. Le gros de l'effort n'était donc a priori pas à fournir sur ce sujet.</p>
<p>Pourtant, la sélection d'un serveur MDA a nécessité plus de temps qu'envisagé a priori :</p>
<ul>
<li>le premier serveur testé est <code>localmail</code> : écrit en python, il propose une boîte mail unique, sans mot de passe, avec un support de SMTP et d'IMAP. Le problème rencontré avec ce serveur est que le client de récupération de mails (fetchmail) détectait une différence de taille entre les tailles annoncées et les flux transmis</li>
<li>le serveur <code>courier-imap</code> : ce serveur semblait être un bon candidat, mais je n'ai pas trouvé rapidement de documentation satisfaisante. Il a donc été écarté</li>
<li>le serveur <code>cyrus-imap</code> : ce serveur a une documentation suffisante, mais il y a eu un problème sur les dépenances des librairies pour son installation via les paquets natifs de ubuntu : un problème sur les libraires perl, qui est un problème connu, lors du lancement de l'outil d'administration cyradm : <a href="https://bugs.launchpad.net/ubuntu/+source/cyrus-imapd/+bug/1971547">https://bugs.launchpad.net/ubuntu/+source/cyrus-imapd/+bug/1971547</a>. De ce fait, ce serveur a été également écarté</li>
<li>le serveur <code>dovecot</code> : ce serveur dispose d'une documentation fournie, et est en plus assez intuitif au niveau de sa configuration. Ubuntu propose d'ailleurs des fichiers de configuration suffisamment commentés pour pouvoir faire une configuration rapide. Cerise sur le gâteau, dovecot fournit une image Docker pour les expérimentations : <a href="https://hub.docker.com/r/dovecot/dovecot/">https://hub.docker.com/r/dovecot/dovecot/</a>. Néanmoins, la compilation d'une image modifiée, depuis les sources <a href="https://github.com/dovecot/docker">https://github.com/dovecot/docker</a> a été requise, en se basant sur la version 2.3.19.1, à cause de l'architecture matérielle utilisée pour les tests (armhf) : il s'agissait donc d'utiliser uniquement les paquets prévus par la distribution Debian (celle utilisée dans le FROM du Dockerfile) pour avoir des packages disponibles vis à vis de l'architecture armhf : mise en commentaire : </li>
</ul>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>#ADD dovecot.gpg /etc/apt/trusted.gpg.d
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>#ADD dovecot.list /etc/apt/sources.list.d
</code></pre></div>
et modification du nom de package <code>dovecot-lua</code> en <code>dovecot-auth-lua</code>.</p>
<p>Cette image est fonctionnelle, et propose une configuration qui accepte les comptes avec le mot de passe "pass", et propose notamment un support LMTP et IMAP. La configuration a été modifiée pour autoriser rapidement l'authentification en texte clair (à ne pas utiliser en production :ajout de <code>disable_plaintext_auth=no</code> dans dovecot.conf). Ce serveur a fait le travail attendu lors des tests.</p>
<h2 id="maildirfetcher">Maildirfetcher</h2>
<p>Le travail consiste ensuite à récupérer les mails et à les mettre à disposition dans un dossier Maildir.
A cette fin, il faut :</p>
<ul>
<li>initialiser un dossier Maildir et les dépendances : outil <code>maildirmake</code></li>
<li>récupérer les mails : outil <code>fetchmail</code></li>
<li>injecter les mails dans le Maildir : outil <code>putmail</code></li>
</ul>
<p>Etant donné que fetchmail s'exécutera comme un "service", il est préférable qu'il ne soit pas exécuté avec les droits root, mais avec un compte inférieur. Il faut donc prendre en compte cette particularité dans les scripts.</p>
<h3 id="initialisation-du-dossier-de-maildir-et-dossiers-dependants">Initialisation du dossier de Maildir et dossiers dépendants</h3>
<p>Maildrop est fourni avec un outil <code>maildirmake</code> qui permet de créer un dossier Maildir.
Une subtitlité a toutefois été mise en oeuvre : pour régler des problèmes de mise en oeuvre des droits, le dossier a été crée avec les droits roots, et les permissions ont ensuite été settées, ce afin de ne pas avoir à donner des permissions d'écritures au niveau parent - ce qui peut être particulièrement embêtant par rapport à des répertoires de montage de volumes.</p>
<p>De même, fetchmail nécessite un dossier avec droits d'écriture pour les fichiers d'ID : ce dossier a été prévu dans un sous-dossier d'un volume monté.</p>
<p>Enfin, fetchmail prévoit également d'écrire son pid dans un fichier : étant donné que ce contenu dépend fondamentalement du conteneur d'exécution, le plus simple est de le stocker dans /tmp.</p>
<p>On arrive donc à un script d'initialisation des volumes, exécuté en root, semblable à :</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">if</span> <span class="o">[[</span> ! <span class="o">(</span>-n <span class="sb">`</span>find /MAILDIR -maxdepth <span class="m">0</span> -type d -empty <span class="sb">`</span><span class="o">)</span> <span class="o">]]</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  <span class="k">then</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>   <span class="nb">echo</span> <span class="s2">&quot;Already initialized&quot;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>   <span class="nb">exit</span> <span class="m">0</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="k">fi</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>maildirmake /MAILDIR/Maildir
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>mkdir /IDFILES/idfiles
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>chown -R www-data:www-data /IDFILES/idfiles
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>chmod <span class="m">700</span> /IDFILES/idfiles
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>chown -R www-data:www-data /MAILDIR/Maildir
</code></pre></div>
Le test a été repris des scripts de l'image <a href="../INTEGRATION/DOCKER/init.html">init</a>.</p>
<h3 id="fetchmail">Fetchmail</h3>
<p>Fetchmail permet de récupérer les mails via des protocoles tels que IMAP ou POP et peut les envoyer autre part, par exemple via SMTP, ou même vers un Mail Delivery Agent (MDA).</p>
<p>Comme précisé auparavant, fetchmail est exécuté via des droits restreints. On en arrive donc à un script quelque peu particulier pour la commande à exécuter dans le container :</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>/exec/initializer.sh
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>sudo -u www-data -E /exec/mailfetcher.sh
</code></pre></div>
Le paramètre <code>-E</code> permet de transmettre l'ensemble des variables d'environnement, et ce, de manière non modifiée. L'intérêt de cette pratique est que l'on récupère l'ensemble des variables d'environnement qui ont été settées pour le container, mais l'inconvénient est que des variables comme HOME ne sont pas settés avec l'utilisateur qui exécute les commandes. Du coup, il faut se méfier lors des appels à des fichiers, car ils pourraient facilement chercher à accéder (sans succès, normalement) au contenu de <code>/root</code>.
A noter qu'on aurait également pu préciser la liste des variables d'environnement à transmettre, mais ceci signifierait que cette liste devrait également être maintenue dans le temps. Il n'y a donc pas de solution parfaite ici.</p>
<p>En ce qui concerne le script d'exécution de fetchmail :</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nb">echo</span> <span class="si">${</span><span class="nv">FETCHMAILCONFIGFILE</span><span class="si">}</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>fetchmail -vvv --nodetach  -f <span class="si">${</span><span class="nv">FETCHMAILCONFIGFILE</span><span class="si">}</span> -i /IDFILES/idfiles/idfile --pidfile /tmp/fetchmail.pid --norewrite --mda <span class="s2">&quot;/exec/putmail.sh&quot;</span>
</code></pre></div>
Les éléments qui doivent être prioritaires et prendre le dessus par rapport au contenu du fichier de configuration sont indiqués directement sur la ligne de commande : il s'agit des réglages pour les chemins, le fait que fetchmail doit être "transparent" (<code>norewrite</code>), et surtout le forçage de la valeur de <code>--mda</code> pour exécuter putmail.</p>
<p>Le fichier de configuration contient les éléments qui permettront d'accéder au serveur IMAP. Pour le test, le fichier est :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>set daemon 60
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>poll dovecot protocol IMAP service 143:
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    username &quot;dst@dst.test&quot; there password &quot;pass&quot; keep sslproto &#39;&#39;
</code></pre></div>
<p>La première ligne permet d'indiquer le fonctionnement en mode daemon, avec un délai de 60 secondes entre les récupérations de courier. La ligne poll contient les options qui sont relatives au serveur de mail à accéder : nom d'hôte, protocole, port.</p>
<p>Fetchmail est particulièrement exigeant au niveau des options de poll : il exige que toutes les options relatives au serveur soient indiquées avant toute option relative à l'utilisateur ou aux utilisateurs (sans quoi une erreur de syntaxe est souvent déclenchée). Cette exigence de syntaxe nécessite bien souvent de se référer à la page de manuel, car il est parfois délicat de bien identifier ce qui relève du serveur et ce qui relève de l'utilisateur.</p>
<p>Au niveau de l'utilisateur, on spécifie le nom d'utilisateur distant le <code>there</code> et le mot de passe. L'option <code>keep</code> garde les mails sur le serveur distant, tandis que l'option <code>sslproto ''</code> a permis de désactiver l'emploi du SSL pour le maquettage. L'option <code>fetchall</code> a dû être supprimée de la configuration : elle déclenchait le retéléchargement des messages qui étaient déjà présents, ce qui n'était pas évident par rapport au manuel.</p>
<p>Lors d'une intégration Kubernetes, on pourra être tenté de passer le set daemon en option de ligne de commande. Une autre approche pourrait être l'exécution via cronjob Kubernetes, ce qui supprimerait l'utilisation du mode daemon.</p>
<h3 id="putmail">Putmail</h3>
<p>Le MDA sélectionné est livré avec le package <code>mailutils-mda</code> : il s'agit de putmail. Il recoit via <code>STDIN</code> le mail à stocker, et l'intègre dans le Maildir fourni en paramètre. Etant donné que putmail est appelé par fetchmail, ses droits d'exécution sont également restreints.</p>
<p>On n'utilise pas de configuration particulière pour putmail : il n'y a donc pas besoin de chercher dans $HOME pour des préférences, $HOME qui pourrait encore être setté à /root si l'on reprend tel quel les variables d'environnement initiales du container. Donc autant ne pas tenter de charger des préférences : option <code>--no-config</code></p>
<p>Script lancé par fetchmail : putmail.sh : </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>putmail --no-config /MAILDIR/Maildir
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nb">exit</span> <span class="nv">$?</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="sendmail.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Envoi" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Envoi
            </div>
          </div>
        </a>
      
      
        
        <a href="../LOGICIEL/index.html" class="md-footer__link md-footer__link--next" aria-label="Next: Index" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Index
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight", "navigation.sections"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>